<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        x:Class="MenuProUI.Views.MainWindow"
        Width="1200" Height="700"
        Title="MenuProUI"
        Icon="avares://MenuProUI/Assets/icon-256.png"
        WindowStartupLocation="CenterScreen"
        mc:Ignorable="d">

  <Grid ColumnDefinitions="320,*" RowDefinitions="Auto,*" Margin="14" RowSpacing="12" ColumnSpacing="12">

    <!-- Top bar with dropdown menus -->
    <Border Grid.ColumnSpan="2" CornerRadius="10" Padding="12" BorderBrush="#333" BorderThickness="1">
      <Grid ColumnDefinitions="Auto,Auto,260,*,Auto,Auto,Auto,Auto" ColumnSpacing="15">
        
        <!-- Menu Clientes -->
        <StackPanel Orientation="Horizontal" Spacing="5">
          <Button Name="ClientsMenuBtn"
                  Width="35"
                  Height="35"
                  Padding="0"
                  FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets"
                  FontSize="24"
                  HorizontalContentAlignment="Center"
                  VerticalContentAlignment="Center"
                  ToolTip.Tip="Menu de Clientes">&#xE716;</Button>
          <TextBlock VerticalAlignment="Center" Text="Clientes" FontWeight="Bold" PointerPressed="OnClientsLabelPressed"/>
        </StackPanel>

        <!-- Menu Acessos -->
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="5">
          <Button Name="AccessesMenuBtn"
                  Width="35"
                  Height="35"
                  Padding="0"
                  FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets"
                  FontSize="24"
                  HorizontalContentAlignment="Center"
                  VerticalContentAlignment="Center"
                  ToolTip.Tip="Menu de Acessos">&#xE7F4;</Button>
          <TextBlock VerticalAlignment="Center" Text="Acessos" FontWeight="Bold" PointerPressed="OnAccessesLabelPressed"/>
        </StackPanel>

        <!-- Busca global -->
        <TextBox Grid.Column="2"
                 Name="GlobalSearchBox"
                 Watermark="ðŸ”Ž Busca global..."
                 Text="{Binding GlobalSearchText}"
                 Padding="10,8" CornerRadius="6" BorderBrush="#333"/>

        <!-- Spacer -->
        <Border Grid.Column="3"/>

        <!-- Quick actions -->
        <Button Grid.Column="4" Content="Tema" Click="OnToggleTheme" ToolTip.Tip="Alternar tema claro/escuro (Ctrl+Alt+T)"/>
        <Button Grid.Column="5" Content="Densidade" Click="OnToggleDensity" ToolTip.Tip="Alternar densidade da lista"/>
        <Button Grid.Column="6" Content="Abrir" Click="OnOpenAccess" ToolTip.Tip="Abrir acesso selecionado (Enter)"/>
        <Button Grid.Column="7" Content="Checar Conectividade" Click="OnCheckConnectivity" ToolTip.Tip="Checar conectividade (Ctrl+Shift+K)"/>
      </Grid>
    </Border>

    <!-- Context menus as popup -->
    <Popup Name="ClientsMenu" IsOpen="False" PlacementTarget="{Binding #ClientsMenuBtn}">
      <Border Background="#1e1e1e" BorderBrush="#333" BorderThickness="1" CornerRadius="6" Padding="0">
        <StackPanel Spacing="0">
          <Button Content="âœš Novo Cliente" Click="OnNewClient" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
          <Border BorderBrush="#333" BorderThickness="0,1,0,0"/>
          <Button Content="âœŽ Editar Cliente" Click="OnEditClient" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
          <Border BorderBrush="#333" BorderThickness="0,1,0,0"/>
          <Button Content="âœ• Excluir Cliente" Click="OnDeleteClient" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
          <Border BorderBrush="#333" BorderThickness="0,1,0,0"/>
          <Button Content="â­³ Exportar backup (3 arquivos)" Click="OnExportBackup" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
          <Border BorderBrush="#333" BorderThickness="0,1,0,0"/>
          <Button Content="â­± Importar backup" Click="OnImportBackup" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
        </StackPanel>
      </Border>
    </Popup>

    <Popup Name="AccessesMenu" IsOpen="False" PlacementTarget="{Binding #AccessesMenuBtn}">
      <Border Background="#1e1e1e" BorderBrush="#333" BorderThickness="1" CornerRadius="6" Padding="0">
        <StackPanel Spacing="0">
          <Button Content="âœš Novo Acesso" Click="OnNewAccess" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
          <Border BorderBrush="#333" BorderThickness="0,1,0,0"/>
          <Button Content="âŽ˜ Clonar Acesso" Click="OnCloneAccess" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
          <Border BorderBrush="#333" BorderThickness="0,1,0,0"/>
          <Button Content="âœŽ Editar Acesso" Click="OnEditAccess" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
          <Border BorderBrush="#333" BorderThickness="0,1,0,0"/>
          <Button Content="âœ• Excluir Acesso" Click="OnDeleteAccess" Padding="12,8" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Background="Transparent"/>
        </StackPanel>
      </Border>
    </Popup>

    <!-- Clients -->
    <Border Grid.Row="1" Grid.Column="0" CornerRadius="10" Padding="12" BorderBrush="#333" BorderThickness="1">
      <Grid RowDefinitions="Auto,Auto,*,Auto,Auto,Auto,Auto" RowSpacing="10">
        
        <!-- Header with counter -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
          <TextBlock Text="Clientes" FontSize="18"/>
          <TextBlock Grid.Column="1" Text="{Binding ClientsFilteredCount, StringFormat={}{0} clientes}" Opacity="0.7" VerticalAlignment="Center"/>
        </Grid>

        <!-- Search box -->
        <TextBox Grid.Row="1" 
                 Name="ClientsSearchBox"
                 Watermark="ðŸ” Buscar cliente..."
                 Text="{Binding ClientsSearchText}"
                 Padding="10,8" CornerRadius="6" BorderBrush="#333"/>

        <!-- Clients list filtered -->
        <ListBox Grid.Row="2" Name="ClientsList"
                 ItemsSource="{Binding ClientsFiltered}"
                 SelectedItem="{Binding SelectedClient}"
                 SelectionChanged="OnClientSelectionChanged">
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Grid ColumnDefinitions="30,*" Margin="4,2">
                <TextBlock Grid.Column="0" Text="{Binding ConnectivityStatusIcon}" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1" Text="{Binding Nome}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
          <ListBox.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Novo Cliente" Click="OnNewClient"/>
              <MenuItem Header="Editar Cliente" Click="OnEditClient"/>
              <MenuItem Header="Excluir Cliente" Click="OnDeleteClient"/>
            </ContextMenu>
          </ListBox.ContextMenu>
        </ListBox>

        <Border Grid.Row="3" BorderBrush="#333" BorderThickness="0,1,0,0" Margin="0,6,0,6"/>

        <TextBlock Grid.Row="4" Text="Arquivos" Opacity="0.8"/>
        <TextBlock Grid.Row="5" Text="{Binding ClientsPath}" Opacity="0.7" FontSize="12" TextTrimming="CharacterEllipsis"/>
        <TextBlock Grid.Row="6" Text="{Binding AccessesPath}" Opacity="0.7" FontSize="12" TextTrimming="CharacterEllipsis"/>
      </Grid>
    </Border>

    <!-- Accesses -->
    <Border Grid.Row="1" Grid.Column="1" CornerRadius="10" Padding="12" BorderBrush="#333" BorderThickness="1">
      <Grid RowDefinitions="Auto,Auto,Auto,*" RowSpacing="10">

        <!-- Header with counter -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="12">
          <TextBlock Text="Acessos" FontSize="18"/>
          <TextBlock Grid.Column="1" Text="{Binding AccessesCountDisplay, StringFormat={}{0} acessos}" Opacity="0.7" VerticalAlignment="Center"/>
          <TextBlock Grid.Column="2" Text="{Binding LastConnectivityCheckText, StringFormat={}Ãšltima checagem: {0}}" Opacity="0.7" VerticalAlignment="Center" FontSize="12"/>
        </Grid>

        <!-- Search box for accesses -->
        <TextBox Grid.Row="1"
                 Name="AccessesSearchBox"
                 Watermark="ðŸ” Buscar acesso..."
                 Text="{Binding AccessesSearchText}"
                 Padding="10,8" CornerRadius="6" BorderBrush="#333"/>

        <!-- Header columns -->
        <Grid Grid.Row="2" ColumnDefinitions="70,90,*" Opacity="0.85">
          <TextBlock Grid.Column="0" Text="Status" FontWeight="Bold"/>
          <TextBlock Grid.Column="1" Text="Tipo" FontWeight="Bold"/>
          <TextBlock Grid.Column="2" Text="Alias / Detalhes" FontWeight="Bold"/>
        </Grid>

        <!-- Accesses list filtered -->
        <ListBox Grid.Row="3"
                 Name="AccessList"
                 ItemsSource="{Binding AccessesFiltered}"
                 SelectedItem="{Binding SelectedAccess}"
                 DoubleTapped="OnOpenAccess">
          <ListBox.Styles>
            <Style Selector="ListBox#AccessList ListBoxItem">
              <Setter Property="Padding" Value="0"/>
              <Setter Property="Margin" Value="0"/>
              <Setter Property="MinHeight" Value="0"/>
            </Style>
          </ListBox.Styles>
          <ListBox.ContextMenu>
            <ContextMenu>
              <MenuItem Header="Novo Acesso" Click="OnNewAccess"/>
              <MenuItem Header="Abrir" Click="OnOpenAccess"/>
              <MenuItem Header="Favoritar/Desfavoritar" Click="OnToggleFavorite"/>
              <MenuItem Header="Clonar" Click="OnCloneAccess"/>
              <MenuItem Header="Editar" Click="OnEditAccess"/>
              <MenuItem Header="Excluir" Click="OnDeleteAccess"/>
            </ContextMenu>
          </ListBox.ContextMenu>

          <ListBox.ItemTemplate>
            <DataTemplate>
              <Border Padding="5" Margin="0,1" CornerRadius="6">
                <Grid ColumnDefinitions="70,90,*,170" RowDefinitions="Auto,Auto" RowSpacing="0" ColumnSpacing="8">
                  <TextBlock Grid.Column="0" Grid.RowSpan="2" Text="{Binding ConnectivityStatusIcon}" VerticalAlignment="Center"/>
                  <TextBlock Grid.Column="1" Grid.RowSpan="2" Text="{Binding TypeIcon}" Opacity="0.95" VerticalAlignment="Center" FontSize="18"/>
                  <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding DisplayMain}" TextTrimming="CharacterEllipsis" FontWeight="SemiBold"/>
                  <TextBlock Grid.Column="2" Grid.Row="1" Text="{Binding DisplayDetails}" TextTrimming="CharacterEllipsis" Opacity="0.85" FontSize="12"/>
                  <StackPanel Grid.Column="3" Grid.RowSpan="2" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center" HorizontalAlignment="Right">
                    <Button Content="{Binding FavoriteIcon}" Foreground="{Binding FavoriteColor}" Click="OnToggleFavorite" CommandParameter="{Binding}" ToolTip.Tip="Favoritar/Desfavoritar" Width="28" Height="28"/>
                    <Button Content="â–¶" Click="OnQuickOpenAccess" CommandParameter="{Binding}" ToolTip.Tip="Abrir" Width="28" Height="28"/>
                    <Button Content="H" Click="OnQuickCopyHost" CommandParameter="{Binding}" ToolTip.Tip="Copiar Host" Width="28" Height="28"/>
                    <Button Content="U" Click="OnQuickCopyUser" CommandParameter="{Binding}" ToolTip.Tip="Copiar UsuÃ¡rio" Width="28" Height="28"/>
                    <Button Content="W" Click="OnQuickCopyUrl" CommandParameter="{Binding}" ToolTip.Tip="Copiar URL" Width="28" Height="28"/>
                  </StackPanel>
                </Grid>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>

      </Grid>
    </Border>

  </Grid>
</Window>
